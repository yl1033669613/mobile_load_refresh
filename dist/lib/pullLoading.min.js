!function(l,t){"use strict";function i(t){return!(!t||void 0===l||t!==l&&!t.nodeType)}function n(t){return l.document.querySelector(t)}function s(t){t.style.display="none"}function e(t){t.style.display="block"}function o(t,l){for(var i in l){var n=i.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()});-1!=n.indexOf("webkit")&&(n="-"+n),t.style[n]=l[i]}}function h(t){return t.scrollTop}function r(t){return t.scrollHeight}function u(t){this._init(t)}u.prototype={constructor:u,_init:function(t){this.dte=80,this.scrollEle=null,this.refreshEl=null,this.pullUpBeforeEl=null,this.pullUpInEl=null,this.pullUpEndEl=null,this.isPullUp=!1,this.isPullDown=!1,this.pullUpLoading=!1,this.pullDownLoading=!1,this.isPullUpEnd=!1,this.currY=0,this.startY=0,this.pullDownY=0,this.contClientHeight=0,this.option=function(t,l,i){for(var n in l)!l.hasOwnProperty(n)||t.hasOwnProperty(n)&&!i||(t[n]=l[n]);return t}({container:"",pullDown:null,pullUp:null},t,!0),this._checkOption()&&(o(this.scrollEle,{overflow:"scroll",webkitOverflowScrolling:"touch"}),this.contClientHeight=this.scrollEle.clientHeight,this.isPullUp&&(e(this.pullUpBeforeEl),s(this.pullUpInEl),s(this.pullUpInEl)),this.isPullDown&&(this.refreshLoadingEleHeight=this.refreshEl.offsetHeight,o(this.refreshEl,{transition:"transform .1s",top:-this.refreshLoadingEleHeight+"px"})),this._initEvent())},_checkOption:function(){var t,l=this.option;if(this.scrollEle=n(l.container),!i(this.scrollEle))throw new Error(l.container+"实例未找到");if(t=this.scrollEle,/HTML|BODY/.test(t.tagName))throw new Error(l.container+"不能是HTML或者BODY节点");if("function"!=typeof l.pullDown&&"function"!=typeof l.pullUp)return!1;if("function"==typeof l.pullDown){if(this.refreshEl=n(l.container+" .pl-down"),!i(this.refreshEl))throw new Error("请添加下拉刷新loading");this.isPullDown=!0}if("function"==typeof l.pullUp){if(this.pullUpBeforeEl=n(l.container+" .pl-up-before"),this.pullUpInEl=n(l.container+" .pl-up-in"),this.pullUpEndEl=n(l.container+" .pl-up-end"),!i(this.pullUpBeforeEl))throw new Error("请添加上拉加载前提示");if(!i(this.pullUpInEl))throw new Error("请添加上拉加载中提示");if(!i(this.pullUpEndEl))throw new Error("请添加上拉加载已加载全部内容提示");this.isPullUp=!0}return!0},_initEvent:function(){this.scrollEle.addEventListener("touchstart",this._touchstartHandle.bind(this)),this.scrollEle.addEventListener("touchmove",this._touchmoveHandle.bind(this)),this.scrollEle.addEventListener("touchend",this._touchendHandle.bind(this)),this.scrollEle.addEventListener("scroll",this._scrollHandle.bind(this))},_touchstartHandle:function(t){this.startY=t.changedTouches[0].clientY,this.currY=t.changedTouches[0].clientY,this.pullDownY=0},_touchmoveHandle:function(t){var l=t.changedTouches[0];if(0==h(this.scrollEle)&&(r(this.scrollEle)<=this.contClientHeight&&this.isPullUp&&l.clientY-this.startY<0&&t.preventDefault(),this.isPullDown&&0<=l.clientY-this.startY&&!this.pullUpLoading&&!this.pullDownLoading)){t.preventDefault(),this.pullDownY=l.clientY-this.currY+this.pullDownY,this.currY=l.clientY;var i=this.pullDownY/(this.dte/this.refreshLoadingEleHeight);i>=this.refreshLoadingEleHeight&&(i=this.refreshLoadingEleHeight),o(this.refreshEl,{transition:"transform 0s",transform:"translate(0, "+i+"px)"})}},_touchendHandle:function(t){if(!this.pullUpLoading&&!this.pullDownLoading){var l=t.changedTouches[0];0==h(this.scrollEle)&&(0<=l.clientY-this.startY?l.clientY-this.startY>=this.dte?(o(this.refreshEl,{transform:"translate(0, "+this.refreshLoadingEleHeight+"px)"}),this._pullDown()):o(this.refreshEl,{transition:"transform .2s",transform:"translate(0, 0)"}):r(this.scrollEle)<=this.contClientHeight&&l.clientY-this.startY<=-this.dte&&this._pullUp())}},_scrollHandle:function(t){h(this.scrollEle)+this.contClientHeight==r(this.scrollEle)&&this._pullUp()},_pullUp:function(){!this.isPullUp||this.isPullUpEnd||this.pullDownLoading||this.pullUpLoading||(this.pullUpLoading=!0,s(this.pullUpBeforeEl),e(this.pullUpInEl),this.option.pullUp&&this.option.pullUp(this))},_pullDown:function(){!this.isPullDown||this.pullDownLoading||this.pullUpLoading||(this.pullDownLoading=!0,this.pullUpEnd(!1),this.option.pullDown&&this.option.pullDown(this))},stopPull:function(){!this.isPullUpEnd&&this.isPullUp&&(e(this.pullUpBeforeEl),s(this.pullUpInEl)),this.isPullDown&&o(this.refreshEl,{transition:"transform .2s",transform:"translate(0, 0)"}),this.pullUpLoading=!1,this.pullDownLoading=!1},pullUpEnd:function(t){this.isPullUp&&((this.isPullUpEnd=t)?(e(this.pullUpEndEl),s(this.pullUpInEl),s(this.pullUpBeforeEl)):(e(this.pullUpBeforeEl),s(this.pullUpInEl),s(this.pullUpEndEl)))}},!("PullLoading"in l)&&(l.PullLoading=u)}(window);